@model WorkFlow.Models.Application

@{
    ViewData["Title"] = "إنشاء تطبيق جديد";
}

<!-- Page Header -->
<div class="page-header mb-4">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="page-title">
                <i class="fas fa-plus-circle text-primary me-2"></i>
                إنشاء تطبيق جديد
            </h1>
            <p class="text-muted mb-0">أضف تطبيق جديد لإدارة العمليات والطلبات</p>
        </div>
        <div class="col-auto">
            <a href="@Url.Action("Index", "Applications")" class="btn btn-outline-secondary btn-modern">
                <i class="fas fa-arrow-right me-2"></i>
                العودة للقائمة
            </a>
        </div>
    </div>
</div>

<!-- Create Form -->
<div class="card-modern">
    <div class="card-header bg-transparent border-0">
        <h3 class="card-title mb-0">
            <i class="fas fa-cogs text-info me-2"></i>
            معلومات التطبيق
        </h3>
    </div>
    <div class="card-body">
        <form id="applicationForm" asp-action="Create" method="post">
            <div class="row">
                <!-- Application Name (English) -->
                <div class="col-md-6 mb-4">
                    <label asp-for="ApplicationNameEng" class="form-label required">
                        <i class="fas fa-language text-primary me-2"></i>
                        اسم التطبيق (إنجليزي)
                    </label>
                    <input type="text" 
                           class="form-control form-control-lg" 
                           asp-for="ApplicationNameEng" 
                           placeholder="أدخل اسم التطبيق بالإنجليزية"
                           required>
                    <span asp-validation-for="ApplicationNameEng" class="text-danger"></span>
                </div>

                <!-- Application Name (Arabic) -->
                <div class="col-md-6 mb-4">
                    <label asp-for="ApplicationNameAr" class="form-label required">
                        <i class="fas fa-language text-success me-2"></i>
                        اسم التطبيق (عربي)
                    </label>
                    <input type="text" 
                           class="form-control form-control-lg" 
                           asp-for="ApplicationNameAr" 
                           placeholder="أدخل اسم التطبيق بالعربية"
                           required>
                    <span asp-validation-for="ApplicationNameAr" class="text-danger"></span>
                </div>
            </div>

            <div class="row">
                <!-- System Info -->
                <div class="col-md-4 mb-4">
                    <label asp-for="SystemInfoId" class="form-label required">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        معلومات النظام
                    </label>
                    <select class="form-select form-select-lg" asp-for="SystemInfoId" asp-items="ViewBag.SystemInfoId">
                        <option value="">اختر معلومات النظام</option>
                    </select>
                    <span asp-validation-for="SystemInfoId" class="text-danger"></span>
                </div>

                <!-- Department -->
                <div class="col-md-4 mb-4">
                    <label asp-for="DepartmentId" class="form-label required">
                        <i class="fas fa-building text-primary me-2"></i>
                        القسم
                    </label>
                    <select class="form-select form-select-lg" asp-for="DepartmentId" asp-items="ViewBag.DepartmentId" onchange="loadSections()">
                        <option value="">اختر القسم</option>
                    </select>
                    <span asp-validation-for="DepartmentId" class="text-danger"></span>
                </div>

                <!-- Section -->
                <div class="col-md-4 mb-4">
                    <label asp-for="SectionId" class="form-label">
                        <i class="fas fa-layer-group text-warning me-2"></i>
                        الشعبة
                    </label>
                    <select class="form-select form-select-lg" asp-for="SectionId" id="sectionSelect">
                        <option value="">اختر الشعبة</option>
                    </select>
                    <span asp-validation-for="SectionId" class="text-danger"></span>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions mt-4">
                <div class="d-flex justify-content-between">
                    <a href="@Url.Action("Index", "Applications")" class="btn btn-outline-secondary btn-modern">
                        <i class="fas fa-times me-2"></i>
                        إلغاء
                    </a>
                    <button type="submit" class="btn btn-primary-modern btn-modern">
                        <i class="fas fa-save me-2"></i>
                        إنشاء التطبيق
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Help Section -->
<div class="card-modern mt-4">
    <div class="card-header bg-transparent border-0">
        <h3 class="card-title mb-0">
            <i class="fas fa-question-circle text-info me-2"></i>
            نصائح مفيدة
        </h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="help-item">
                    <div class="help-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h6>اسم التطبيق</h6>
                    <p class="text-muted">اختر اسم واضح ومفهوم للتطبيق باللغتين العربية والإنجليزية</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="help-item">
                    <div class="help-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h6>القسم والشعبة</h6>
                    <p class="text-muted">حدد القسم والشعبة المسؤولة عن إدارة هذا التطبيق</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="help-item">
                    <div class="help-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h6>معلومات النظام</h6>
                    <p class="text-muted">اختر نوع النظام المناسب للتطبيق الذي تريد إنشاءه</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-label.required::after {
        content: " *";
        color: var(--danger-color);
    }

    .form-control-lg, .form-select-lg {
        border-radius: 12px;
        border: 2px solid rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        padding: 12px 16px;
    }

    .form-control-lg:focus, .form-select-lg:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
    }

    .form-actions {
        padding-top: 2rem;
        border-top: 1px solid rgba(0,0,0,0.1);
    }

    .help-item {
        text-align: center;
        padding: 1rem;
    }

    .help-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 20px;
    }

    .help-item h6 {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .help-item p {
        font-size: 0.9rem;
        margin-bottom: 0;
    }

    .card-modern .card-body {
        padding: 2rem;
    }

    @@media (max-width: 768px) {
        .form-actions .d-flex {
            flex-direction: column;
        }
        
        .form-actions .btn {
            width: 100%;
            margin-bottom: 1rem;
        }
        
        .card-modern .card-body {
            padding: 1.5rem;
        }
    }
</style>

<script>
    function loadSections() {
        var departmentId = $('#DepartmentId').val();
        var sectionSelect = $('#sectionSelect');
        
        if (departmentId) {
            $.ajax({
                url: '@Url.Action("GetSeactionByDep", "Applications")',
                type: 'GET',
                data: { DepartmentId: departmentId },
                success: function(data) {
                    sectionSelect.empty();
                    sectionSelect.append('<option value="">اختر الشعبة</option>');
                    
                    $.each(data, function(index, item) {
                        sectionSelect.append('<option value="' + item.sectionId + '">' + item.sectionNameEng + '</option>');
                    });
                },
                error: function() {
                    Swal.fire({
                        title: 'خطأ!',
                        text: 'حدث خطأ أثناء تحميل الشعب',
                        icon: 'error',
                        confirmButtonText: 'حسناً'
                    });
                }
            });
        } else {
            sectionSelect.empty();
            sectionSelect.append('<option value="">اختر الشعبة</option>');
        }
    }

    $(document).ready(function() {
        // Form validation
        $('#applicationForm').on('submit', function(e) {
            var isValid = true;
            
            // Check required fields
            $('.required').each(function() {
                var field = $(this).attr('for');
                var input = $('#' + field);
                
                if (!input.val()) {
                    isValid = false;
                    input.addClass('is-invalid');
                } else {
                    input.removeClass('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                Swal.fire({
                    title: 'تنبيه!',
                    text: 'يرجى ملء جميع الحقول المطلوبة',
                    icon: 'warning',
                    confirmButtonText: 'حسناً'
                });
            }
        });

        // Real-time validation
        $('input[required], select[required]').on('blur', function() {
            if (!$(this).val()) {
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        });
    });
</script>

@Html.Partial("_JSApplication")